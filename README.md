geo	2007	2008	2009	2010	2011	2012	2013	2014	2015	2016	mean	geometry
Belgium	95.2	95	95.2	95.5	96.9	97	96.6	99.2	99.3	99.8	96.97	POLYGON ((3.314971144228537 51.34578095153609,...
Name: geometry, dtype: object
Bulgaria	54.8	50.4	45.9	62	65.6	67.5	66	62.2	64.1	63.8	60.23	POLYGON ((22.65714969248299 44.23492300066128,...
Name: geometry, dtype: object
Czech Rep.	71.2	74.1	75.8	77.9	75.2	73.6	74.7	78.6	79.5	79.9	76.05	POLYGON ((16.96028812019458 48.5969823268506, ...
Name: geometry, dtype: object
Denmark	96.5	97.5	108.1	108.1	90.5	89	93.4	92.2	94	96.1	96.54	POLYGON ((12.69000613775563 55.60999095318078...
Name: geometry, dtype: object
Germany	94.7	94.8	94.9	95.7	97.4	96.8	97.7	97.8	97.2	97.2	96.42	POLYGON ((9.921906365609232 54.98310415304803,...
Name: geometry, dtype: object
Estonia	51.7	44.7	58.9	61.6	67	67.8	77.7	82	80.1	83.8	67.53	POLYGON ((24.31286258311462 57.79342357037697,...
Name: geometry, dtype: object
Republic of Ireland	63.6	64.7	69.9	73.7	79	86.6	88.1	90.6	91.4	87.6	79.52	POLYGON ((-6.197884894220991 53.86756500916336...
Name: geometry, dtype: object
Greece	48	43.8	52.3	58.8	62.1	58.6	52.8	54.3	60.7	67.2	55.86	POLYGON ((23.699980096133 35.70500438083553, ...
Name: geometry, dtype: object
Spain	62.1	65.4	67.8	70	72.1	72.5	73.1	75	72.6	76.8	70.74	POLYGON ((-9.034817674180246 41.88057058365968...
Name: geometry, dtype: object
France	67.4	65.2	66.4	70.3	71.2	74.7	75.4	74.6	75.5	75.6	71.63	POLYGON ((-52.55642473001839 2.50470530843705...
Name: geometry, dtype: object
Croatia	57.1	57.1	57.1	57.1	57.1	59.7	58.8	52.8	60.1	54.7	57.16	POLYGON ((18.82983808765005 45.90887767189184,...
Name: geometry, dtype: object
Italy	67	68.6	74	74.7	74	76.3	76.5	76.4	77.9	78	74.34	POLYGON ((15.52037601081383 38.23115509699147...
Name: geometry, dtype: object
Cyprus	25.9	34.3	42.5	50.1	52	55.7	56.6	58.7	59.9	59.9	49.56	POLYGON ((33.97361657078346 35.058506374648, 3...
Name: geometry, dtype: object
Latvia	40.9	51.7	51.1	52.7	53.7	54.6	54.5	58.4	62.1	60.2	53.99	POLYGON ((21.05580040862242 56.03107636171107,...
Name: geometry, dtype: object
Lithuania	44.1	52.2	58.4	60.9	62.9	62.5	53.9	57.9	60.2	69.7	58.27	POLYGON ((22.73109866709265 54.32753693299333,...
Name: geometry, dtype: object
Luxembourg	92	93.7	91.4	90.3	92.5	93	91.8	96.1	94.7	97.3	93.28	POLYGON ((6.043073357781111 50.12805166279423,...
Name: geometry, dtype: object
Hungary	54.6	56.5	55	62.3	62.9	60.1	60.3	59.7	58.1	59.9	58.94	POLYGON ((16.20229821133736 46.85238597267696,...
Name: geometry, dtype: object
Malta	10.4	45.9	36.9	29.2	44.7	47.5	38.2	41.3	37.2	39.7	37.1	POLYGON ((14.56714928500011 35.84560781500004...
Name: geometry, dtype: object
Netherlands	93.5	95.1	96.9	96.8	95.2	92.7	94.2	94.2	95	94.7	94.83	POLYGON ((6.074182570020923 53.51040334737814,...
Name: geometry, dtype: object
Austria	90.2	91.5	92.6	92.2	93.7	94	96.1	96.2	96.3	95.7	93.85	POLYGON ((16.97966678230404 48.12349701597631,...
Name: geometry, dtype: object
Poland	60	50.6	50.3	53.7	55.9	57.1	50.4	60	60.9	61.7	56.06	POLYGON ((15.01699588385867 51.10667409932158,...
Name: geometry, dtype: object
Portugal	59.1	66	65.8	61.3	62.9	59.9	64.8	64.1	60.2	64	62.81	POLYGON ((-9.034817674180246 41.88057058365968...
Name: geometry, dtype: object
Romania	36.6	40.7	46.7	48.3	54.4	57.4	54.5	56.4	56.9	62.3	51.42	POLYGON ((22.71053144704049 47.88219391538941,...
Name: geometry, dtype: object
Slovenia	53	57.9	53.4	65.8	70.5	78	92.5	88.1	77.4	81.1	71.77	POLYGON ((13.80647545742153 46.50930613869122,...
Name: geometry, dtype: object
Slovakia	67.4	50	63.2	47.5	65	70	69.5	68	66.7	69.5	63.68	POLYGON ((18.85314415861362 49.49622976337764,...
Name: geometry, dtype: object
Finland	83.7	90	88	85	89.6	93.3	93.2	98.3	102.2	109.8	93.31	POLYGON ((28.59192955904319 69.06477692328666,...
Name: geometry, dtype: object
Sweden	81.5	79.8	77	97.6	100.8	98	78.2	77.9	79.5	71	84.13	POLYGON ((22.18317345550193 65.72374054632017,...
Name: geometry, dtype: object
United Kingdom	63.8	65.5	66.7	67.3	67.1	69.1	72.7	64.1	64.7	71.4	67.24	POLYGON ((-5.661948614921897 54.5546031764838...
Name: geometry, dtype: object
Iceland	56.3	56.3	56.3	47.8	64.6	56.5	65.7	65.7	63.8	67.5	60.05	POLYGON ((-14.50869544112923 66.45589223903143...
Name: geometry, dtype: object
Liechtenstein	100	100	100	91.4	91	90	90.9	91.2	92.2	92.2	93.89	POLYGON ((9.581202840000032 47.05687042300008,...
Name: geometry, dtype: object
Norway	89.9	82.5	80.9	88.8	88.1	92.7	93.2	96.7	95.5	96.4	90.47	POLYGON ((28.16554731620292 71.18547435168051...
Name: geometry, dtype: object




# GeoMap
Trying to add data to a geomap
from bokeh.core.properties import value
from bokeh.io import show, output_notebook
from bokeh.models import (Rect, Text, GeoJSONDataSource, DataRange1d, Range1d, ColumnDataSource, FactorRange, FixedTicker,
                          Legend, NumeralTickFormatter, LabelSet, LogColorMapper, HoverTool, LinearColorMapper,
                         GMapPlot, GMapOptions )
from bokeh.plotting import figure
from bokeh.transform import dodge
from bokeh.palettes import Pastel2, viridis, inferno, magma, Paired, Spectral
from bokeh.transform import factor_cmap, linear_cmap
from collections import Counter
from bokeh.layouts import gridplot
from bokeh.io import export_png
from bokeh.models.glyphs import MultiLine, Line
import geopandas as gpd

import itertools
import pandas as pd
import copy
import matplotlib.pyplot as plt
import numpy as np
 
output_notebook()

import itertools
import pandas as pd
import copy
import matplotlib.pyplot as plt
import numpy as np
 
output_notebook()

df_map2 = pd.read_csv('countries_geom2.csv', delimiter='\t', index_col=0)
world = gpd.read_file(gpd.datasets.get_path('naturalearth_lowres'))

world = gpd.read_file(gpd.datasets.get_path('naturalearth_lowres'))
europe = (world.loc[world['continent'] == 'Europe'])
europe.head()

geo1_source = GeoJSONDataSource(geojson=df_map2.to_json())
geo_source = GeoJSONDataSource(geojson=europe.to_json())

palette = ['#b9ef96', '#9ae968', '#7be23a', '#6cdf23', '#64dd17']
color_mapper = LinearColorMapper(palette=palette)

TOOLS = 'pan, wheel_zoom, box_zoom, reset, hover, save'
p = figure(plot_height=600, width=500, title='Europe',tools=TOOLS,
            x_range=(-30,60), y_range=(30,85),
           x_axis_location=None, y_axis_location=None)
p.patches('xs', 'ys', fill_alpha=0.7, fill_color='green', line_color='black', line_width=0.5, source=geo1_source)
hover = p.select_one(HoverTool)
hover.point_policy = 'follow_mouse'
hover.tooltips = [('Countries','@geo')]


show(p)


# with geocode from googlemaps




def Geocode(query):
    # do geocoding
    query = str(query)
    try:
        geocode_result = gm.geocode(query)[0]       
        latitude = geocode_result['geometry']['location']['lat']
        longitude = geocode_result['geometry']['location']['lng']
        return latitude,longitude
    except IndexError:
        return 0
        
def GeocodeLatLng(data):
    lat=[]                            # initialize latitude list
    lng=[]                            # initialize longitude list
    [maxRow, maxCol]=data.shape
                                      
    start = data.index[0]             # start from the first data
    end = data.index[maxRow-1]        # end at maximum number of row
    for i in range(start,end+1,1):    # iterate all rows in the data
        isSuccess=True                # initial Boolean flag
        query = data.index[i] # try set up query 
        result=Geocode(query)
        if result==0:         
            result=Geocode(query)
            if result==0:     # if still not successful,
                                 # try set up another query 
                result=Geocode(query)
                if Geocode(query)==0: # if still not successful,
                    isSuccess=False                                           # mark as unsuccessful
                    print(i, 'is failed')
                else:
                    print(i, result)
            else:
                print(i, result)
        else:
            print(i, result)
        if isSuccess==True:           # if geocoding is successful,
            # store the results
            lat.append(result[0])     # latitude
            lng.append(result[1])     # longitude
    return lat,lng

# call the geocoding function
[lat,lng]=GeocodeLatLng(df_c)

# we put the list of latitude,longitude into pandas data frame
df = pd.DataFrame(
    {'latitude': lat,
     'longitude': lng
    })
    

